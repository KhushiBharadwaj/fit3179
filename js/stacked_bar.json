{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Horizontal stacked (normalised) bar by field.",
  "width": 360,                       
  "height": {"step": 28},             
  "data": {"url": "data/enrolments_by_fields.csv", "format":{"type":"csv"}},
  "transform": [
    {"fold": ["Male","Female","Persons"], "as": ["Sex","PercentRaw"]},
    {"calculate": "toNumber(datum.PercentRaw)", "as": "Percent"}
  ],
  "mark": {"type": "bar", "tooltip": true},
  "encoding": {
    "y": {
      "field": "FieldOfEducation",
      "type": "nominal",
      "title": "Field of education",
      "axis": {"labelLimit": 300, "labelPadding": 6}   
    },
    "x": {
      "aggregate": "sum",
      "field": "Percent",
      "type": "quantitative",
      "stack": "normalize",
      "title": "% share within field"
    },
    "color": {
      "field": "Sex",
      "type": "nominal",
      "title": null,
      "scale": {
        "domain": ["Male","Female","Persons"],
        "range": ["#006EFF","#F658EB","#808080"]
      }
    },
    "order": {"field":"Sex"}
  },
  "config": {"legend": {"orient":"top"}}
}